# RaspiWatch

Fletで構築されたデスクトップクロックアプリケーションで、時間、温度、湿度、および天気情報を表示します。このアプリケーションは、DHT22温湿度センサー、AM312人感センサー、CdS光センサーを搭載したRaspberry Piでの実行を想定しており、SwitchBotデバイス制御をサポートしています。

[English version here](README.md)

## 機能

- リアルタイム時計表示
- 大阪の現在の天気状況
- 温度と湿度のモニタリング（DHT22センサーが必要）
- 6時間ごとの天気更新
- フルスクリーン表示サポート
- CdSフォトレジスタを使用した光状態検出
  - ライトがONの場合は太陽アイコン、OFFの場合は月アイコンを表示
  - 二値（オン/オフ）の光状態検出を提供
- SwitchBotデバイス制御統合
  - 人の存在検知と現在の光状態に基づいてライトを制御
  - AM312 PIRセンサーによる人の存在検知
  - 人の存在と現在の光状態に基づく自動ライト制御

## 必要条件

- Raspberry Pi
- Python 3.7以上
- DHT22温湿度センサー
- AM312人感センサー
- CdSフォトレジスタ（光センサー）
- Raspberry PiのGPIOピンD18、GPIO26、およびアナログ入力が利用可能であること
- SwitchBotアカウントと互換性のあるデバイス

## ハードウェアセットアップ

1. DHT22センサーをRaspberry Piに接続します：
   - センサーのデータピンをGPIO18（ピンD18）に接続
   - VCCを3.3Vまたは5V電源に接続
   - GNDをグラウンドに接続

2. AM312人感センサーを接続します：
   - VCCをGPIOピン2（5V電源）に接続
   - GNDをGPIOピン9（グラウンド）に接続
   - OUTをGPIOピン37（GPIO26）に接続

3. CdSフォトレジスタを接続します：
   - CdSセルと固定抵抗でボルテージディバイダー回路を設定
   - CdSセルの一端を3.3Vに接続
   - もう一端をアナログ入力ピンと、抵抗を介してグラウンドに接続
   - 正確なセットアップについてはドキュメントの配線ガイドに従ってください

## インストール

1. リポジトリをクローンします：
```bash
git clone https://github.com/yourusername/RaspiWatch.git
```

2. デバイスIDを取得します（不明な場合）：
```bash
python watch_app/src/get_device_id.py
```
このスクリプトは、利用可能なすべてのSwitchBotデバイスとそのIDをリストアップします。

3. SwitchBot認証情報を設定します：
```bash
python setup.py
```
SwitchBot APIトークン、シークレットトークン、デバイスIDの入力を求められます。これらの認証情報の取得方法については、[SwitchBot API Documentation](https://github.com/OpenWonderLabs/SwitchBotAPI)を参照してください。

4. 必要なパッケージをインストールします：
```bash
pip install -r requirements.txt
```

## 使用方法

アプリケーションを開始するには、次のコマンドを実行します：
```bash
cd RaspiWatch
flet run watch_app
```

## 光検出システム

本アプリケーションは、CdSフォトレジスタを使用して部屋の現在の光状態を検出し、より賢明なライト制御を可能にしています：

- アプリケーションは、ディスプレイの右上隅にアイコンで現在の光状態を表示します：
  - ライトがONと検出された場合は太陽アイコン
  - ライトがOFFと検出された場合は月アイコン

- この光検出は、SwitchBot APIが一部のライトデバイスの現在の状態を確実に報告できないため必要です。

- CdSセンサーは二値（オン/オフ）の光検出を提供します。今後のアップデートでは、ブレッドボード上のマイコンを使用してより正確な光レベル測定を行い、より細かい制御を可能にする予定です。

### 制限事項

- CdSセンサーは、実際の室内ライトがOFFであっても、カーテンを開けたままにして直射日光などの自然光が部屋に入ってくる場合、誤ってライトをONと検出する可能性があります。
- 最良の結果を得るには、自然光源からの干渉なしに人工室内照明を正確に検出できる位置にCdSセンサーを配置してください。

## 今後のアップデート

- より正確な光レベル検出のためのマイコンとの統合
- 複数のSwitchBotデバイスタイプのサポート
- 光レベル、時刻、人の存在に基づく強化されたライト制御アルゴリズム

## ライセンス

このプロジェクトはApache License 2.0の下でライセンスされています - 詳細は[LICENSE](LICENSE)ファイルを参照してください。